<?
	$days = $_REQUEST['days'] * 1;
	$newdate = strtotime("-" . $days . " days");
	$dtar = array();
			
	$beenhere = false;
	
	$queryopendays = "SELECT TOP 10 count(*) as cnt, MalwareName from Logs where DateTimeOfEvent >= '" . date("Y-m-d",$newdate) . 
	" 00:00:00' and DateTimeOfEvent <= '" . date("Y-m-d H:i:s") . 
	"' and MalwareName not LIKE 'Possible_%' group by MalwareName order by cnt DESC";
	
	//echo $queryopendays;
	$request = mssql_query($queryopendays);
	
	echo "{\"totalCount\":[" . mssql_num_rows($request) . "],\"malware\":[";
	
	while ($rs = mssql_fetch_array($request)) {
		if ($beenhere)
			echo ",";
			
		$beenhere = true;
		
		echo "{";
		echo "\"MalwareName\":\"" . $rs['MalwareName'] . "\",";
		echo "\"Count\":\"" . $rs['cnt'] . "\"";		
		echo "}";
	}
	
	echo "]}";
	
		?> 